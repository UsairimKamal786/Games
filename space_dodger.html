<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Space Dodger — Simple HTML/CSS/JS Game</title>
  <style>
    /* Basic page layout */
    :root{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial;margin:0}
    body{display:flex;align-items:center;justify-content:center;height:100vh;background:#071029;color:#e6f0ff}
    .wrapper{width:min(900px,95vw);max-width:900px}
    h1{margin:6px 0 10px;font-size:20px;text-align:center}
    /* Canvas container */
    .game-box{background:linear-gradient(180deg,#071029 0%, #0a1730 100%);border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(2,6,23,.6)}
    canvas{display:block;width:100%;height:480px;border-radius:8px;background:transparent}
    .hud{display:flex;justify-content:space-between;align-items:center;color:#cfe7ff;margin-top:8px}
    .btn{background:#0b6bff;border:none;padding:8px 12px;border-radius:8px;color:white;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .small{font-size:13px;color:#bcd9ff}
    footer{margin-top:10px;text-align:center;font-size:12px;color:#9fbce0}
    /* Simple mobile touch controls */
    .touch-controls{display:none;gap:8px;justify-content:center;margin-top:10px}
    .touch-controls button{padding:12px;border-radius:8px;border:none;background:#10294a;color:#e6f0ff;font-weight:700}
    @media (max-width:600px){
      canvas{height:360px}
      .touch-controls{display:flex}
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Space Dodger</h1>
    <div class="game-box">
      <canvas id="game"></canvas>
      <div class="hud">
        <div>
          <div>Score: <span id="score">0</span></div>
          <div class="small">High: <span id="high">0</span></div>
        </div>
        <div>
          <button id="startBtn" class="btn">Start / Restart</button>
          <button id="pauseBtn" class="btn">Pause</button>
        </div>
      </div>
      <div class="touch-controls" aria-hidden="true">
        <button id="leftTouch">◀</button>
        <button id="upTouch">▲</button>
        <button id="downTouch">▼</button>
        <button id="rightTouch">▶</button>
      </div>
    </div>
    <footer>Controls: Arrow keys or tap buttons (mobile). Avoid the asteroids and survive as long as possible.</footer>
  </div>

<script>
/*
  Space Dodger
  - Single HTML file game using canvas.
  - Controls: Arrow keys (left/right) to move, up to boost. On mobile, use touch buttons.
  - objective: dodge falling asteroids; score increases with time.
*/

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let W, H;
function resize() {
  // Use devicePixelRatio for crisp rendering
  const ratio = Math.max(1, window.devicePixelRatio || 1);
  W = Math.min(900, window.innerWidth * 0.95);
  H = Math.round(Math.max(360, Math.min(540, window.innerHeight * 0.6)));
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';
  canvas.width = Math.round(W * ratio);
  canvas.height = Math.round(H * ratio);
  ctx.setTransform(ratio,0,0,ratio,0,0);
}
window.addEventListener('resize', resize);
resize();

// Game state
let running = false;
let paused = false;
let lastTime = 0;
let spawnTimer = 0;
let spawnInterval = 900; // ms
let asteroids = [];
let player = { x: W/2, y: H - 80, w:36, h:48, speed: 340, vy:0 };
let score = 0;
let high = Number(localStorage.getItem('sd_high')||0);
let difficulty = 1; // increases over time

// Helpers
function rand(min,max){return Math.random()*(max-min)+min}

function startGame(){
  running = true; paused=false; asteroids = []; score=0; difficulty=1; spawnInterval=900; player.x = W/2; player.y = H-80; lastTime = performance.now();
  document.getElementById('score').textContent = '0';
  loop(lastTime);
}

function endGame(){
  running = false;
  if(score > high){ high = score; localStorage.setItem('sd_high', String(high)); document.getElementById('high').textContent = high; }
  // simple flash message
  ctx.save();
  ctx.fillStyle='rgba(2,2,8,0.6)'; ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#fff'; ctx.textAlign='center'; ctx.font='28px system-ui';
  ctx.fillText('Game Over — Score: '+Math.floor(score), W/2, H/2 - 10);
  ctx.font='16px system-ui'; ctx.fillText('Click Start to try again', W/2, H/2 + 22);
  ctx.restore();
}

// Input
const input = { left:false, right:false, up:false, down:false };
window.addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft') input.left=true;
  if(e.key==='ArrowRight') input.right=true;
  if(e.key==='ArrowUp') input.up=true;
  if(e.key==='ArrowDown') input.down=true;
});
window.addEventListener('keyup', e=>{
  if(e.key==='ArrowLeft') input.left=false;
  if(e.key==='ArrowRight') input.right=false;
  if(e.key==='ArrowUp') input.up=false;
  if(e.key==='ArrowDown') input.down=false;
});

// Touch buttons hooks
['leftTouch','rightTouch','upTouch','downTouch'].forEach(id=>{
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener('touchstart', e=>{ e.preventDefault(); if(id.startsWith('left')) input.left=true; if(id.startsWith('right')) input.right=true; if(id.startsWith('up')) input.up=true; if(id.startsWith('down')) input.down=true; });
  el.addEventListener('touchend', e=>{ e.preventDefault(); if(id.startsWith('left')) input.left=false; if(id.startsWith('right')) input.right=false; if(id.startsWith('up')) input.up=false; if(id.startsWith('down')) input.down=false; });
});

// Asteroid factory
function spawnAsteroid(){
  const size = rand(18,48) * (1 + difficulty*0.12);
  const x = rand(size/2, W - size/2);
  const speed = rand(80, 180) + difficulty*30;
  asteroids.push({ x, y: -size, r: size/2, speed, rot: rand(0,Math.PI*2), rotSpeed: rand(-1,1)*0.02 });
}

function update(dt){
  // player movement
  if(input.left) player.x -= player.speed * dt;
  if(input.right) player.x += player.speed * dt;
  if(input.up) player.y -= player.speed * 0.8 * dt; // small vertical movement
  if(input.down) player.y += player.speed * 0.6 * dt;
  // clamp
  player.x = Math.max(player.w/2, Math.min(W - player.w/2, player.x));
  player.y = Math.max(40, Math.min(H - player.h/2, player.y));

  // spawn logic
  spawnTimer += dt*1000;
  if(spawnTimer > spawnInterval){ spawnAsteroid(); spawnTimer = 0; }

  // update asteroids
  for(let i=asteroids.length-1;i>=0;i--){
    const a = asteroids[i];
    a.y += a.speed * dt;
    a.rot += a.rotSpeed;
    // remove offscreen
    if(a.y - a.r > H + 60) asteroids.splice(i,1);
  }

  // collisions
  for(const a of asteroids){
    const dx = a.x - player.x;
    const dy = a.y - player.y;
    const dist = Math.hypot(dx,dy);
    if(dist < a.r + Math.max(player.w, player.h)/2 - 6){
      running = false; // hit!
    }
  }

  // scoring & difficulty over time
  score += dt * 10 * difficulty;
  difficulty += dt * 0.025; // slowly ramp up
  spawnInterval = Math.max(320, 900 - difficulty*80);
  document.getElementById('score').textContent = Math.floor(score);
}

function draw(){
  // clear
  ctx.clearRect(0,0,W,H);

  // starfield background
  const stars = 60;
  for(let i=0;i<stars;i++){
    const sx = (i*47)%W;
    const sy = (i*83*1.3)%H;
    ctx.fillStyle = (i%7===0)?'#e6f0ff':'#9fbce0';
    ctx.fillRect(sx, sy, 1.2, 1.2);
  }

  // draw player (simple ship)
  ctx.save();
  ctx.translate(player.x, player.y);
  ctx.beginPath();
  ctx.moveTo(0,-player.h/2);
  ctx.lineTo(player.w/2, player.h/2);
  ctx.lineTo(-player.w/2, player.h/2);
  ctx.closePath();
  ctx.fillStyle = '#58a6ff';
  ctx.fill();
  ctx.fillStyle = '#cfe7ff';
  ctx.fillRect(-6, player.h/6, 12, 6); // cockpit
  ctx.restore();

  // draw asteroids
  for(const a of asteroids){
    ctx.save();
    ctx.translate(a.x, a.y);
    ctx.rotate(a.rot);
    ctx.beginPath();
    // jagged circle
    const steps = 8;
    for(let i=0;i<steps;i++){
      const ang = (i/steps)*Math.PI*2;
      const rad = a.r * (0.75 + 0.4*Math.sin(ang*3 + a.rot*5 + i));
      const px = Math.cos(ang)*rad;
      const py = Math.sin(ang)*rad;
      if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
    }
    ctx.closePath();
    ctx.fillStyle = '#89776b';
    ctx.fill();
    ctx.restore();
  }

  // small HUD
  ctx.fillStyle='rgba(0,0,0,0.15)'; ctx.fillRect(8,8,120,36);
  ctx.fillStyle='#e6f0ff'; ctx.font='14px system-ui'; ctx.fillText('Score: '+Math.floor(score), 16, 30);
}

function loop(now){
  if(!running){ endGame(); return; }
  if(paused){ ctx.fillStyle='rgba(0,0,0,0.3)'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#fff'; ctx.font='22px system-ui'; ctx.textAlign='center'; ctx.fillText('Paused', W/2, H/2); requestAnimationFrame(loop); return; }
  const dt = Math.min(0.05, (now - lastTime) / 1000);
  lastTime = now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}

// Buttons
document.getElementById('startBtn').addEventListener('click', ()=>{ startGame(); });
document.getElementById('pauseBtn').addEventListener('click', ()=>{ paused = !paused; document.getElementById('pauseBtn').textContent = paused? 'Resume' : 'Pause'; if(!paused && running){ lastTime = performance.now(); loop(lastTime); } });

// initialize high score UI
document.getElementById('high').textContent = high;

// place player in center once layout stabilizes
window.addEventListener('load', ()=>{ player.x = W/2; player.y = H - 80; draw(); });

// small accessibility: click canvas to start if not running
canvas.addEventListener('click', ()=>{ if(!running) startGame(); });

</script>
</body>
</html>
