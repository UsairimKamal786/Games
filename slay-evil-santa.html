<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Slay the Night Before Christmas</title>
<style>
body{margin:0;background:black;overflow:hidden;font-family:Poppins,sans-serif;color:white;text-align:center}
#ui{position:absolute;top:10px;left:10px;font-size:20px;display:block;}
#msg{position:absolute;top:35%;width:100%;font-size:50px;font-weight:700;display:none;text-shadow:0 0 20px red;color:red;}
canvas{display:block;}
</style>
</head>
<body>

<div id="ui">‚ù§Ô∏è HP: <span id="hp">210</span> | üéÖ Santa HP: <span id="shp">200</span> | üõ° Turrets: <span id="tc">0</span></div>
<div id="msg"></div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let keys = {};
window.addEventListener("keydown", e => keys[e.code]=true);
window.addEventListener("keyup", e => keys[e.code]=false);

// Player
let player = {x:80,y:canvas.height-140,w:40,h:60,hp:210,sp:6,atk:0,t:0,alive:true};

// Santa
let santa = {x:canvas.width-200,y:canvas.height-140,w:80,h:80,hp:200,alive:true};

// Turrets
let turrets = [];
let turretCount = 0;

// Bullets
let bullets = [];
const SLASH_TIME = 15;

// Spawn 5 turrets at start
function spawnTurrets(){
  for(let i=0;i<5;i++){
    turrets.push({x:Math.random()*(canvas.width-100)+50,
                  y:Math.random()*(canvas.height-200)+50,
                  w:30,h:30,alive:true,cd:0});
  }
  turretCount = 5;
}
spawnTurrets();

// Shoot bullets
function shoot(fromX,fromY,targetX,targetY,speed,owner){
  let a = Math.atan2(targetY-fromY,targetX-fromX);
  bullets.push({x:fromX,y:fromY,vx:Math.cos(a)*speed,vy:Math.sin(a)*speed,own:owner});
}

// Game active flag
let gameActive = true;

function update(){
  if(!gameActive) return;

  // Move
  if(keys.ArrowLeft) player.x -= player.sp;
  if(keys.ArrowRight) player.x += player.sp;
  if(keys.ArrowUp) player.y -= player.sp;
  if(keys.ArrowDown) player.y += player.sp;
  player.x = Math.max(0,Math.min(canvas.width-player.w,player.x));
  player.y = Math.max(0,Math.min(canvas.height-player.h,player.y));

  // Sword attack
  if(keys.Space && !player.atk){player.atk=1;player.t=SLASH_TIME;}
  if(player.atk){player.t--; if(player.t<=0) player.atk=0;}

  // Santa attack
  if(santa.alive && Math.random()<0.01){
    shoot(santa.x+20,santa.y+40,player.x,player.y,5,"santa");
  }

  // Turrets attack
  turrets.forEach(t=>{
    if(!t.alive) return;
    t.cd++; 
    if(t.cd>60){ 
      t.cd=0; 
      shoot(t.x+15,t.y+15,player.x,player.y,4,"turret"); 
    }
    // Sword hit turrets
    if(player.atk && t.x<player.x+player.w+50 && t.x+t.w>player.x && t.y<player.y+player.h && t.y+t.h>player.y){
      t.alive=false; turretCount--;
    }
  });

  // Sword hits Santa
  if(player.atk && santa.alive && santa.x<player.x+player.w+60 && santa.x+santa.w>player.x && santa.y<player.y+player.h && santa.y+santa.h>player.y){
    santa.hp -=12;
    if(santa.hp<=0) santa.alive=false;
  }

  // Bullets
  bullets.forEach(b=>{
    b.x += b.vx; b.y += b.vy;
    if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height) b.dead=1;
    if(!b.dead && b.x>player.x && b.x<player.x+player.w && b.y>player.y && b.y<player.y+player.h){
      player.hp -= (b.own=="santa"?10:6); b.dead=1;
      if(player.hp<=0){ 
        player.alive=false; 
        gameActive = false;
        msg.textContent="GAME OVER - Christmas Failed"; 
        msg.style.display="block"; 
      }
    }
  });
  bullets = bullets.filter(b=>!b.dead);

  // Check Santa death
  if(!santa.alive && gameActive){
    gameActive = false;
    msg.textContent="CHRISTMAS SAVED!";
    msg.style.display="block";
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Player
  ctx.fillStyle="#4cc9ff";
  if(player.alive) ctx.fillRect(player.x,player.y,player.w,player.h);

  // Sword
  if(player.atk) ctx.fillStyle="white", ctx.fillRect(player.x+player.w,player.y+20,50,8);

  // Santa
  if(santa.alive) ctx.fillStyle="red", ctx.fillRect(santa.x,santa.y,santa.w,santa.h);

  // Turrets
  ctx.fillStyle="#ff9f1c";
  turrets.forEach(t=>{if(t.alive) ctx.fillRect(t.x,t.y,t.w,t.h);});

  // Bullets
  ctx.fillStyle="white";
  bullets.forEach(b=>ctx.fillRect(b.x,b.y,6,6));

  document.getElementById("hp").textContent = Math.max(0,Math.floor(player.hp));
  document.getElementById("shp").textContent = Math.max(0,Math.floor(santa.hp));
  document.getElementById("tc").textContent = Math.max(0,turretCount);

  requestAnimationFrame(draw);
}

setInterval(update,1000/60);
draw();
</script>

</body>
</html>
