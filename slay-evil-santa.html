<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Slay the Night Before Christmas</title>
<style>
body{margin:0;background:black;overflow:hidden;font-family:Poppins,sans-serif;color:white;text-align:center}
#menu{
  position:absolute;top:0;left:0;width:100%;height:100%;
  background:linear-gradient(#0a0f24,#1a1f3a);
  display:flex;flex-direction:column;justify-content:center;align-items:center;gap:20px;
}
button{
  padding:12px 28px;font-size:22px;border:none;border-radius:12px;cursor:pointer;font-weight:700;
}
#how,#final{display:none;font-size:24px;max-width:600px;line-height:1.6}
canvas{display:none;background:linear-gradient(#0a0f24,#1a1f3a)}
#ui{position:absolute;top:10px;left:10px;font-size:20px;display:none}
#msg{position:absolute;top:35%;width:100%;font-size:50px;font-weight:700;display:none;text-shadow:0 0 20px red;color:red}
</style>
</head>
<body>

<div id="menu">
  <h1 style="font-size:60px;text-shadow:0 0 30px cyan">SLAY EVIL SANTA</h1>

  <button onclick="show('how')">How to Play</button>
  <button onclick="show('final')">Final Combat</button>

  <div id="how">
    ‚öîÔ∏è Arrow Keys ‚Üí Move<br>
    Space ‚Üí Sword Slash<br>
    Turrets shoot from all sides<br>
    Slice them by pressing Space near them<br>
    Kill Santa to save Christmas<br><br>
    <button onclick="back()">Back</button>
  </div>

  <div id="final">
    Press START to begin the battle<br><br>
    <button onclick="startGame()">START</button>
  </div>
</div>

<div id="ui">‚ù§Ô∏è HP: <span id="hp">100</span> | üéÖ Santa HP: <span id="shp">200</span> | üõ° Turrets: <span id="tc">0</span></div>
<div id="msg">SANTA SLAIN.<br>CHRISTMAS SAVED.</div>
<canvas id="game"></canvas>

<script>
function show(id){
  how.style.display="none";
  final.style.display="none";
  document.getElementById(id).style.display="block";
}
function back(){ how.style.display="none"; final.style.display="none"; }

const c=document.getElementById("game"),ctx=c.getContext("2d");
c.width=innerWidth; c.height=innerHeight;
let keys={};
onkeydown=e=>keys[e.code]=1;
onkeyup=e=>keys[e.code]=0;

let p={x:80,y:c.height-140,w:40,h:60,hp:100,sp:6,atk:0,t:0};
let s={x:c.width-200,y:c.height-140,w:80,h:80,hp:200,alive:1};

let turrets=[], turretTimer=0, turretCount=0;
const SLASH_TIME=15;
let bullets=[];

function spawnTurrets(){
  for(let i=0;i<5;i++){
    turrets.push({x:Math.random()*(c.width-100)+50,y:Math.random()*(c.height-200)+50,w:30,h:30,alive:1,cd:0});
  }
  turretCount=5;
}

function shoot(fromX,fromY,targetX,targetY,speed,owner){
  let a=Math.atan2(targetY-fromY,targetX-fromX);
  bullets.push({x:fromX,y:fromY,vx:Math.cos(a)*speed,vy:Math.sin(a)*speed,own:owner});
}

function upd(){
  if(!s.alive) return;

  if(keys.ArrowLeft) p.x-=p.sp;
  if(keys.ArrowRight) p.x+=p.sp;
  if(keys.ArrowUp) p.y-=p.sp;
  if(keys.ArrowDown) p.y+=p.sp;
  p.x=Math.max(0,Math.min(c.width-p.w,p.x));
  p.y=Math.max(0,Math.min(c.height-p.h,p.y));

  if(keys.Space && !p.atk){ p.atk=1; p.t=SLASH_TIME; }
  if(p.atk){ p.t--; if(p.t<=0) p.atk=0; }

  if(s.alive && Math.random()<0.01){ shoot(s.x+20,s.y+40,p.x,p.y,5,"santa"); }

  for(let t of turrets){
    if(!t.alive) continue;
    t.cd++; if(t.cd>60){t.cd=0; shoot(t.x+15,t.y+15,p.x,p.y,4,"turret");}
    if(p.atk && t.x<p.x+p.w+50 && t.x+t.w>p.x && t.y<p.y+p.h && t.y+t.h>p.y){ t.alive=0; turretCount--; }
  }

  if(p.atk && s.x<p.x+p.w+60 && s.x+s.w>p.x && s.y<p.y+p.h && s.y+s.h>p.y){ s.hp-=12; }

  for(let b of bullets){
    b.x+=b.vx; b.y+=b.vy;
    if(b.x<0||b.x>c.width||b.y<0||b.y>c.height) b.dead=1;
    if(!b.dead && b.x<p.x+p.w && b.x>p.x && b.y<p.y+p.h && b.y>p.y){ p.hp -= (b.own=="santa"?10:6); b.dead=1; }
  }
  bullets=bullets.filter(b=>!b.dead);

  if(s.hp<=0){ s.alive=0; msg.style.display="block"; }
}

function drw(){
  ctx.clearRect(0,0,c.width,c.height);
  ctx.fillStyle="#4cc9ff"; ctx.fillRect(p.x,p.y,p.w,p.h);
  if(p.atk){ ctx.fillStyle="white"; ctx.fillRect(p.x+p.w,p.y+20,50,8); }
  if(s.alive){ ctx.fillStyle="red"; ctx.fillRect(s.x,s.y,s.w,s.h); }
  ctx.fillStyle="#ff9f1c"; for(let t of turrets){ if(t.alive) ctx.fillRect(t.x,t.y,t.w,t.h); }
  ctx.fillStyle="white"; for(let b of bullets) ctx.fillRect(b.x,b.y,6,6);

  hp.textContent=Math.floor(p.hp);
  shp.textContent=Math.max(0,Math.floor(s.hp));
  tc.textContent=Math.max(0,turretCount);
  requestAnimationFrame(drw);
}

function startGame(){
  menu.style.display="none";
  ui.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  c.style.display="block";
  spawnTurrets();
  setInterval(upd,1000/60);
  drw();
}

spawnTurrets(); // also spawns 5 on load in case player skips menu
canvas.style.display="none";
</script>

</body>
</html>
